
c------------------------------------------------------------
c
c   |A|        |  0    0   24    0    0    0 | |a| obs_n(n-2)
c   |B|     1  |  2  -16    0   16   -2    0 | |b| obs_n(n-1)
c   |C| = ---- | -1   16  -30   16   -1    0 | |c| obs_n(n  )
c   |D|    24  | -9   39  -70   66  -33    7 | |d| obs_n(n+1)
c   |E|        | 13  -64  126 -124   61  -12 | |e| obs_n(n+2)
c   |F|        | -5   25  -50   50  -25    5 | |f| obs_n(n+3)
c
      real*8 function dspline3(rn,o,Ns)
      implicit none
 
      integer Ns 
      real*8 rn
      real*8 o(Ns)

      real*8 A, B, C, D, E, F ! value times 24 

      integer n
      real*8 x
    
      n = int(rn)
     
      if (n.lt.3.or.n.ge.Ns-2) then
          if (n.lt.   3) n = 3
          if (n.gt.Ns-2) n = Ns-2

c
c    1  -0.000000000   0.000000000  24.000000000   0.000000000  -0.000000000
c    2   2.000000000 -16.000000000   0.000000000  16.000000000  -2.000000000
c    3  -1.000000000  16.000000000 -30.000000000  16.000000000  -1.000000000
c    4  -2.000000000   4.000000000  -0.000000000  -4.000000000   2.000000000
c    5   1.000000000  -4.000000000   6.000000000  -4.000000000   1.000000000
c

          A =  0*o(n-2) +  0*o(n-1) + 24*o(n) +  0*o(n+1) + 0*o(n+2)
          B =  2*o(n-2) - 16*o(n-1) +  0*o(n) + 16*o(n+1) - 2*o(n+2)
          C = -1*o(n-2) + 16*o(n-1) - 30*o(n) + 16*o(n+1) - 1*o(n+2)
          D = -2*o(n-2) +  4*o(n-1) -  0*o(n) -  4*o(n+1) + 2*o(n+2)
          E =  1*o(n-2) -  4*o(n-1) +  6*o(n) -  4*o(n+1) + 1*o(n+2)

          x = rn-n
          dspline3 = A/24
     .             + B/24*x
     .             + C/24*x**2
     .             + D/24*x**3
     .             + E/24*x**4
          return
          endif

      A =  0*o(n-2)+  0*o(n-1)+ 24*o(n)+  0*o(n+1)+  0*o(n+2)+  0*o(n+3)
      B =  2*o(n-2)- 16*o(n-1)+  0*o(n)+ 16*o(n+1)-  2*o(n+2)+  0*o(n+3)
      C = -1*o(n-2)+ 16*o(n-1)- 30*o(n)+ 16*o(n+1)-  1*o(n+2)+  0*o(n+3)
      D = -9*o(n-2)+ 39*o(n-1)- 70*o(n)+ 66*o(n+1)- 33*o(n+2)+  7*o(n+3)
      E = 13*o(n-2)- 64*o(n-1)+126*o(n)-124*o(n+1)+ 61*o(n+2)- 12*o(n+3)
      F = -5*o(n-2)+ 25*o(n-1) -50*o(n)+ 50*o(n+1)- 25*o(n+2)+  5*o(n+3)
 
      x = rn-n
 
      dspline3 = A/24
     .         + B/24*x
     .         + C/24*x**2
     .         + D/24*x**3
     .         + E/24*x**4
     .         + F/24*x**5

      return
      end
      
      
  
